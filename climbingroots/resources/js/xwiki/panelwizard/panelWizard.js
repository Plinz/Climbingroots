function computeBounds(){leftPanelsLeft=getX(leftPanels);leftPanelsRight=leftPanelsLeft+leftPanels.offsetWidth;rightPanelsLeft=getX(rightPanels);rightPanelsRight=rightPanelsLeft+rightPanels.offsetWidth;allpanelsLeft=getX(allPanels);allpanelsTop=getY(allPanels)}function debugwrite(a){document.getElementById("headerglobal").appendChild(document.createTextNode(a))}function isPanel(a){return a&&a.nodeType===1&&a.classList.contains("panel")&&$(a).up("#leftPanels, #rightPanels, #allviewpanels")}function getX(a){if(a.offsetParent){if(window.ActiveXObject){return a.offsetLeft+getX(a.offsetParent)+a.clientLeft}else{return a.offsetLeft+getX(a.offsetParent)+(a.scrollWidth-a.clientWidth)}}else{if(a.x){return a.x}else{return 0}}}function getY(a){if(a.offsetParent){if(window.ActiveXObject){return a.offsetTop+getY(a.offsetParent)+a.clientTop}else{return a.offsetTop+getY(a.offsetParent)+(a.scrollHeight-a.clientHeight)}}else{if(a.y){return a.y}else{return 0}}}function getBlocList(d){var e=[];var a=d.childNodes.length;for(var c=0;c<a;++c){var b=d.childNodes[c];if(isPanel(b)){if(!b.isDragging){e.push(b)}}}return e}function getDragBoxPos(c,d){var a=c.length;if(a==0){return 0}for(var b=0;b<a;++b){if(c[b]==dragel){return b}}return -1}function getAllPanels(d){var e=[];var c=d.getElementsByTagName("div");var a=0;for(var b=0;b<c.length;++b){if(isPanel(c[b])){e[a]=c[b];a++}}return e}function getClosestDropTarget(a,d,b,c){if(window.showLeftColumn==1&&(a<=leftPanelsRight&&(a+b)>=leftPanelsLeft)){return leftPanels}if(window.showRightColumn==1&&((a+b)>=rightPanelsLeft&&a<=rightPanelsRight)){return rightPanels}return allPanels}function onDragStart(b,a,f){if(b.isDragging){return}hideTip();window.isDraggingPanel=true;if(enabletip==true){hideTip()}realParent=b.parentNode;parentNode=b.parentNode;var d=(realParent!=leftPanels&&realParent!=rightPanels);var c=Position.cumulativeOffset(b);var e=Position.realOffset(b);var a=c[0];var f=c[1]-e[1]+(document.documentElement.scrollTop-0+document.body.scrollTop-0);if(window.ActiveXObject){dragel.style.height=(b.offsetHeight?(b.offsetHeight):b.displayHeight)+"px"}else{dragel.style.height=(b.offsetHeight?(b.offsetHeight-2):b.displayHeight)+"px"}dragel.style.display="block";b.style.left=a+"px";b.style.top=f+"px";b.style.zIndex="10";if(d){parentNode=allPanels;b.placeholder=document.createElement("div");b.placeholder.className="placeholder";if(window.ActiveXObject){b.placeholder.style.height=(b.offsetHeight?(b.offsetHeight):b.displayHeight)+"px"}else{b.placeholder.style.height=(b.offsetHeight?(b.offsetHeight-2):b.displayHeight)+"px"}realParent.replaceChild(b.placeholder,b);b.placeholder.style.display="block";addClass(allPanels,"dropTarget")}else{realParent.replaceChild(dragel,b)}b.style.position="absolute";document.body.appendChild(b);b.isDragging=true;prevcolumn=parentNode}function onDrag(b,a,e){if(enabletip==true){hideTip()}parentNode=getClosestDropTarget(a,e,b.offsetWidth,b.offsetHeight);if(parentNode!=prevcolumn){if(prevcolumn!=allPanels){prevcolumn.removeChild(dragel)}if(parentNode!=allPanels){parentNode.appendChild(dragel);rmClass(allPanels,"dropTarget")}else{addClass(allPanels,"dropTarget")}}prevcolumn=parentNode;var c=getBlocList(parentNode);var d=getDragBoxPos(c,e);if(d==-1){return}if(c.length==0){if(parentNode!=allPanels){parentNode.appendChild(dragel)}}else{if(d!=0&&e<=getY(c[d-1])){parentNode.insertBefore(dragel,c[d-1])}else{if(d!=(c.length-1)&&e>=getY(c[d+1])){if(c[d+2]){parentNode.insertBefore(dragel,c[d+2])}else{if(parentNode!=allPanels){parentNode.appendChild(dragel)}else{dragel.parentNode.removeChild(dragel)}}}}}}function onDragEnd(b,a,c){b.isDragging=false;window.isDraggingPanel=false;b.style.position="static";if(parentNode==allPanels){b.placeholder.parentNode.replaceChild(b,b.placeholder);b.placeholder=undefined;rmClass(allPanels,"dropTarget")}else{parentNode.replaceChild(b,dragel)}dragel.style.display="none";updatePanelLayout()}var updatePanelLayout=function(){if(leftPanelsInput&&!leftPanelsInput.disabled){leftPanelsInput.value=getBlocNameList(leftPanels)}if(rightPanelsInput&&!rightPanelsInput.disabled){rightPanelsInput.value=getBlocNameList(rightPanels)}};function executeCommand(c,e){function a(){if(d.readyState==4){if(d.status==200){if(b){b(d.responseText)}else{new XWiki.widgets.Notification("no callback defined","error")}}else{new XWiki.widgets.Notification("There was a problem retrieving the xml data:\n"+d.status+":\t"+d.statusText+"\n"+d.responseText,"error")}}}var d=null;var b=e;if(window.XMLHttpRequest){d=new XMLHttpRequest();d.onreadystatechange=a;d.open("GET",c,true);d.send(null)}else{if(window.ActiveXObject){d=new ActiveXObject("Microsoft.XMLHTTP");if(d){d.onreadystatechange=a;d.open("GET",c,true);d.send()}else{new XWiki.widgets.Notification("your browser does not support xmlhttprequest","error")}}else{new XWiki.widgets.Notification("your browser does not support xmlhttprequest","error")}}}function start1(){var b;var a;var f;var d=document.getElementsByTagName("div");for(b=0;b<d.length;++b){c=d[b];var e=c.id;if(isPanel(c)){attachDragHandler(c)}}window.panelsInList=getAllPanels(allPanels);window.panelsOnLeft=getBlocList(leftPanels);window.panelsOnRight=getBlocList(rightPanels);var c;for(b=0;b<panelsInList.length;++b){f=window.allPanelsPlace[b]["left"];if(f!=-1){c=panelsOnLeft[f];if(c){c.fullname=window.allPanelsPlace[b].fullname;c.placeholder=document.createElement("div");c.placeholder.className="placeholder";if(window.ActiveXObject){c.displayHeight=(c.offsetHeight?(c.offsetHeight):0)}else{c.displayHeight=(c.offsetHeight?(c.offsetHeight-2):0)}c.placeholder.style.height=(c.displayHeight)+"px";c.placeholder.style.display="block";panelsInList[b].parentNode.replaceChild(c.placeholder,panelsInList[b])}}f=window.allPanelsPlace[b]["right"];if(f!=-1){c=panelsOnRight[f];if(c){c.fullname=window.allPanelsPlace[b].fullname;c.placeholder=document.createElement("div");c.placeholder.className="placeholder";if(window.ActiveXObject){c.displayHeight=(c.offsetHeight?(c.offsetHeight):0)}else{c.displayHeight=(c.offsetHeight?(c.offsetHeight-2):0)}c.placeholder.style.height=(c.displayHeight)+"px";c.placeholder.style.display="block";if(panelsInList[b].parentNode){panelsInList[b].parentNode.replaceChild(c.placeholder,panelsInList[b])}}}panelsInList[b].fullname=window.allPanelsPlace[b].fullname}leftPanels.savedPanelList=getBlocList(leftPanels);rightPanels.savedPanelList=getBlocList(rightPanels);leftPanels.isVisible=window.showLeftColumn;rightPanels.isVisible=window.showRightColumn;if(!leftPanels.isVisible){leftPanels.panels=getBlocList(leftPanels)}if(!rightPanels.isVisible){rightPanels.panels=getBlocList(rightPanels)}layoutMaquettes=$("PageLayoutSection").select(".pagelayoutoption")}function attachDragHandler(a){a.ondblclick=function(b){};Drag.init(a,a);a.onDragStart=function(b,c){onDragStart(this,b,c)};a.onDrag=function(b,c){onDrag(this,b,c)};a.onDragEnd=function(b,c){onDragEnd(this,b,c)}}function isAttachedPanel(a){if(a.ondblclick){return true}return false}function getBlocNameList(d){var e="";var a=d.childNodes.length;for(var c=0;c<a;++c){var b=d.childNodes[c];if(isPanel(b)){if(!b.isDragging){if(e!=""){e+=","}e+=b.fullname}}}return e}function save(){url=window.ajaxurl;url+="&showLeftPanels="+window.showLeftColumn;url+="&showRightPanels="+window.showRightColumn;if(window.showLeftColumn){var a=leftPanelsInput?leftPanelsInput.value:getBlocNameList(leftPanels);url+="&leftPanels="+a;url+="&leftPanelsWidth="+leftPanelsWidthInput.value}if(window.showRightColumn){var b=rightPanelsInput?rightPanelsInput.value:getBlocNameList(rightPanels);url+="&rightPanels="+b;url+="&rightPanelsWidth="+rightPanelsWidthInput.value}executeCommand(url,saveResult)}function saveResult(a){if(a=="SUCCESS"){new XWiki.widgets.Notification(window.panelsavesuccess,"done");leftPanels.savedPanelList=getBlocList(leftPanels);rightPanels.savedPanelList=getBlocList(rightPanels);leftPanels.isVisible=window.showLeftColumn;rightPanels.isVisible=window.showRightColumn}else{alert(window.panelsaveerror);alert(a)}}function releasePanels(b){b.panels=getBlocList(b);for(var a=0;a<b.panels.length;++a){releasePanel(b.panels[a])}}function releasePanel(a){a.parentNode.removeChild(a);a.placeholder.parentNode.replaceChild(a,a.placeholder);a.placeholder=undefined}function restorePanels(b){for(var a=0;a<b.panels.length;++a){if(!b.panels[a].placeholder){restorePanel(b.panels[a],b)}}b.panels=undefined}function revertPanels(b){for(var a=0;a<b.savedPanelList.length;++a){restorePanel(b.savedPanelList[a],b)}}function restorePanel(b,a){b.placeholder=document.createElement("div");b.placeholder.className="placeholder";if(window.ActiveXObject){b.placeholder.style.height=(b.offsetHeight?(b.offsetHeight):0)}else{b.placeholder.style.height=(b.offsetHeight?(b.offsetHeight-2):0)}b.placeholder.style.display="block";b.parentNode.replaceChild(b.placeholder,b);a.appendChild(b)}function changePreviewLayout(a,b){document.getElementById("selectedoption").id="";a.id="selectedoption";mainContainer.removeClassName("hidelefthideright");mainContainer.removeClassName("hideright");mainContainer.removeClassName("hideleft");mainContainer.removeClassName("content");switch(b){case 0:if(window.showLeftColumn==1){window.showLeftColumn=0;leftPanels.style.display="none";releasePanels(leftPanels)}if(window.showRightColumn==1){window.showRightColumn=0;rightPanels.style.display="none";releasePanels(rightPanels)}mainContainer.addClassName("hidelefthideright");leftPanelsInput&&leftPanelsInput.disable();leftPanelsWidthInput.disable();rightPanelsInput&&rightPanelsInput.disable();rightPanelsWidthInput.disable();break;case 1:if(window.showLeftColumn==0){window.showLeftColumn=1;leftPanels.style.display="block";restorePanels(leftPanels)}if(window.showRightColumn==1){window.showRightColumn=0;rightPanels.style.display="none";releasePanels(rightPanels)}mainContainer.addClassName("hideright");leftPanelsInput&&leftPanelsInput.enable();leftPanelsWidthInput.enable();rightPanelsInput&&rightPanelsInput.disable();rightPanelsWidthInput.disable();break;case 2:if(window.showLeftColumn==1){window.showLeftColumn=0;leftPanels.style.display="none";releasePanels(leftPanels)}if(window.showRightColumn==0){window.showRightColumn=1;rightPanels.style.display="block";restorePanels(rightPanels)}mainContainer.addClassName("hideleft");leftPanelsInput&&leftPanelsInput.disable();leftPanelsWidthInput.disable();rightPanelsInput&&rightPanelsInput.enable();rightPanelsWidthInput.enable();break;case 3:if(window.showLeftColumn==0){window.showLeftColumn=1;leftPanels.style.display="block";restorePanels(leftPanels)}if(window.showRightColumn==0){window.showRightColumn=1;rightPanels.style.display="block";restorePanels(rightPanels)}mainContainer.addClassName("content");leftPanelsInput&&leftPanelsInput.enable();leftPanelsWidthInput.enable();rightPanelsInput&&rightPanelsInput.enable();rightPanelsWidthInput.enable();break;default:break}computeBounds()}function revert(){releasePanels(leftPanels);releasePanels(rightPanels);revertPanels(leftPanels);revertPanels(rightPanels);var a=0;if(leftPanels.isVisible){a+=1}if(rightPanels.isVisible){a+=2}setPanelWidth();changePreviewLayout(layoutMaquettes[a],a);updatePanelLayout()}function setPanelWidth(){var d=["Small","Medium","Large"];for(var a=0;a<d.length;++a){var f=d[a];mainContainer.removeClassName("panel-left-width-"+f);mainContainer.removeClassName("panel-right-width-"+f);window.leftPanels.removeClassName("panel-width-"+f);window.rightPanels.removeClassName("panel-width-"+f)}var e="Medium";var b="Medium";if(d.includes(leftPanelsWidthInput.value)){e=leftPanelsWidthInput.value}if(d.includes(rightPanelsWidthInput.value)){b=rightPanelsWidthInput.value}mainContainer.addClassName("panel-left-width-"+e);mainContainer.addClassName("panel-right-width-"+b);window.leftPanels.addClassName("panel-width-"+e);window.rightPanels.addClassName("panel-width-"+b)}function panelEditorInit(){tipobj=$("dhtmltooltip");parentNode=null;realParent=null;dragel=new Element("div",{id:"dragbox","class":"panel"});dragWidth=0;nb=0;layoutMaquetes=null;window.leftPanels=$("leftPanels");window.rightPanels=$("rightPanels");allPanels=$("allviewpanels");mainContent=$("contentcolumn");mainContainer=$("body");leftPanelsLeft=getX(leftPanels);leftPanelsRight=leftPanelsLeft+leftPanels.offsetWidth;rightPanelsLeft=getX(rightPanels);rightPanelsRight=rightPanelsLeft+rightPanels.offsetWidth;allpanelsLeft=getX(allPanels);allpanelsTop=getY(allPanels);leftPanelsInput=$("XWiki.XWikiPreferences_0_leftPanels");leftPanelsWidthInput=$("XWiki.XWikiPreferences_0_leftPanelsWidth");rightPanelsInput=$("XWiki.XWikiPreferences_0_rightPanels");rightPanelsWidthInput=$("XWiki.XWikiPreferences_0_rightPanelsWidth");leftPanelsWidthInput.observe("change",setPanelWidth);rightPanelsWidthInput.observe("change",setPanelWidth);prevcolumn=allPanels;start1();var a=$("selectedoption");changePreviewLayout(a,a.previousSiblings().size())}function waitForAsync(a){if(!document.getElementsByClassName("xwiki-async").length||a>1000){panelEditorInit()}else{a+=10;setTimeout(waitForAsync,10,a)}}waitForAsync(0);